<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{_layout}">

<head>
    <title th:text="'Products in ' + ${category.name}">Category Products</title>
    <style>
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .investment-card {
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .investment-card:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .revenue-card {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .revenue-card:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .profit-card {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .profit-card:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .stock-card {
            background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .stock-card:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .table-hover:hover {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .product-avatar {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }
        .category-avatar {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }
        .alert-success {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            border: none;
            color: white;
        }
        .alert-error {
            background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
            border: none;
            color: white;
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
<div layout:fragment="content">

    <!-- Flash Messages -->
    <div th:if="${successMessage}" class="alert-success rounded-2xl p-4 mb-6 shadow-lg animate-fade-in">
        <div class="flex items-center">
            <i class="bi bi-check-circle-fill mr-3 text-xl"></i>
            <span th:text="${successMessage}"></span>
        </div>
    </div>
    <div th:if="${errorMessage}" class="alert-error rounded-2xl p-4 mb-6 shadow-lg animate-fade-in">
        <div class="flex items-center">
            <i class="bi bi-exclamation-triangle-fill mr-3 text-xl"></i>
            <span th:text="${errorMessage}"></span>
        </div>
    </div>

    <!-- Enhanced Header -->
    <div class="mb-8 flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4 animate-fade-in">
        <div class="flex items-center">
            <div class="w-16 h-16 category-avatar rounded-2xl flex items-center justify-center mr-4">
                <i class="bi bi-tags-fill text-white text-2xl"></i>
            </div>
            <div>
                <h1 class="text-3xl font-bold text-gray-900" th:text="'Products in ' + ${category.name}">Products in Category</h1>
                <p class="mt-1 text-lg text-gray-600">Product catalog and inventory analytics</p>
                <div class="flex items-center mt-2">
                    <span class="inline-flex px-3 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800">
                        <i class="bi bi-box-fill mr-1"></i><span th:text="${totalProducts}">0</span> Products
                    </span>
                    <span class="ml-3 text-sm text-gray-500" th:text="'Category ID: #' + ${category.id}">Category ID: #123</span>
                </div>
            </div>
        </div>
        <div class="flex flex-wrap gap-3">
            <a th:href="@{/categories/{id}(id=${category.id})}"
               class="bg-gradient-to-r from-gray-600 to-gray-700 text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all duration-300 font-medium">
                <i class="bi bi-arrow-left mr-2"></i>Back to Category
            </a>
            <a th:href="@{/products/create(categoryId=${category.id})}"
               class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-8 py-3 rounded-xl hover:shadow-lg transition-all duration-300 font-medium pulse-animation">
                <i class="bi bi-plus-circle mr-2"></i>Add New Product
            </a>
        </div>
    </div>

    <!-- Product Analytics Cards -->
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-8">
        <!-- Total Products Card -->
        <div class="metric-card rounded-2xl text-white p-6 shadow-xl animate-fade-in">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-white/80 text-sm font-medium">Total Products</p>
                    <p class="text-3xl font-bold mt-2" th:text="${totalProducts ?: 0}">0</p>
                    <div class="flex items-center mt-2">
                        <i class="bi bi-box text-white/60 mr-1"></i>
                        <span class="text-white/80 text-sm font-medium">In Catalog</span>
                    </div>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                    <i class="bi bi-boxes text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Total Investment Card -->
        <div class="investment-card rounded-2xl text-white p-6 shadow-xl animate-fade-in" style="animation-delay: 0.1s;">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-white/80 text-sm font-medium">Total Investment</p>
                    <p class="text-3xl font-bold mt-2" th:text="'₹' + ${#numbers.formatDecimal(totalInvestment ?: 0, 1, 0)}">$0</p>
                    <div class="flex items-center mt-2">
                        <i class="bi bi-credit-card text-white/60 mr-1"></i>
                        <span class="text-white/80 text-sm font-medium">Cost Basis</span>
                    </div>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                    <i class="bi bi-wallet text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Potential Revenue Card -->
        <div class="revenue-card rounded-2xl text-white p-6 shadow-xl animate-fade-in" style="animation-delay: 0.2s;">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-white/80 text-sm font-medium">Potential Revenue</p>
                    <p class="text-3xl font-bold mt-2" th:text="'₹' + ${#numbers.formatDecimal(totalPotentialRevenue ?: 0, 1, 0)}">$0</p>
                    <div class="flex items-center mt-2">
                        <i class="bi bi-trending-up text-white/60 mr-1"></i>
                        <span class="text-white/80 text-sm font-medium">At Full Sale</span>
                    </div>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                    <i class="bi bi-currency-dollar text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Potential Profit Card -->
        <div class="profit-card rounded-2xl text-white p-6 shadow-xl animate-fade-in" style="animation-delay: 0.3s;">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-white/80 text-sm font-medium">Potential Profit</p>
                    <p class="text-3xl font-bold mt-2" th:text="'₹' + ${#numbers.formatDecimal(totalPotentialProfit ?: 0, 1, 0)}">$0</p>
                    <div class="flex items-center mt-2">
                        <i class="bi bi-graph-up text-white/60 mr-1"></i>
                        <span class="text-white/80 text-sm font-medium" th:text="${#numbers.formatDecimal(avgProfitMargin ?: 0, 1, 1)} + '% margin'">0.0% margin</span>
                    </div>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                    <i class="bi bi-trophy text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Stock Alert Card -->
        <div class="stock-card rounded-2xl text-white p-6 shadow-xl animate-fade-in" style="animation-delay: 0.4s;">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-white/80 text-sm font-medium">Low Stock Alert</p>
                    <p class="text-3xl font-bold mt-2" th:text="${lowStockCount ?: 0}">0</p>
                    <div class="flex items-center mt-2">
                        <i class="bi bi-exclamation-triangle text-white/60 mr-1"></i>
                        <span class="text-white/80 text-sm font-medium">Items Need Restock</span>
                    </div>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                    <i class="bi bi-flag text-2xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Products Table -->
    <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 overflow-hidden animate-fade-in" style="animation-delay: 1s;">
        <div class="px-6 py-6 border-b border-gray-200/50">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-xl font-semibold text-gray-900">Product Catalog</h3>
                    <p class="mt-1 text-sm text-gray-600">Complete inventory with pricing and stock information</p>
                </div>
                <div class="flex items-center space-x-2">
                    <input type="text" id="productSearch" placeholder="Search products..."
                           class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                    <button onclick="exportProductData()"
                            class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all duration-300 font-medium">
                        <i class="bi bi-download mr-2"></i>Export
                    </button>
                </div>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200/50">
                <thead class="bg-gray-50/50 backdrop-blur-sm">
                <tr>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Product</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Brand & Supplier</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Pricing</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Stock</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Profit Margin</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Sales</th>
                    <th scope="col" class="relative px-6 py-4"><span class="sr-only">Actions</span></th>
                </tr>
                </thead>
                <tbody class="divide-y divide-gray-200/30">
                <!-- Empty State -->
                <tr th:if="${#lists.isEmpty(products)}">
                    <td colspan="7" class="px-6 py-16 text-center">
                        <div class="flex flex-col items-center">
                            <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-2xl flex items-center justify-center mb-4">
                                <i class="bi bi-box text-gray-400 text-3xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">No products found</h3>
                            <p class="text-sm text-gray-500 mb-6">This category doesn't have any products yet.</p>
                            <a th:href="@{/products/create(categoryId=${category.id})}"
                               class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all duration-300 font-medium">
                                <i class="bi bi-plus-circle mr-2"></i>Add First Product
                            </a>
                        </div>
                    </td>
                </tr>

                <!-- Product Rows -->
                <tr th:each="product : ${products}" class="table-hover">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-12 w-12">
                                <div class="h-12 w-12 product-avatar rounded-xl flex items-center justify-center">
                                    <i class="bi bi-box text-white text-xl"></i>
                                </div>
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-bold text-gray-900">
                                    <a th:href="@{/products/{id}(id=${product.productId})}"
                                       th:text="${product.name}"
                                       class="hover:text-blue-600 transition-colors duration-150"></a>
                                </div>
                                <div class="text-xs text-gray-500" th:text="'Code: ' + ${product.productCode ?: 'N/A'}">Code: N/A</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900 font-medium" th:text="${product.brandName ?: 'No Brand'}">Brand</div>
                        <div class="text-sm text-gray-500" th:text="${product.supplier?.name ?: 'No Supplier'}">Supplier</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="space-y-1">
                            <div class="flex items-center" th:if="${product.actualPrice != null}">
                                <span class="text-xs text-gray-500 mr-2">Cost:</span>
                                <span class="text-sm font-bold text-orange-600" th:text="'₹' + ${#numbers.formatDecimal(product.actualPrice, 1, 2)}">$0.00</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-xs text-gray-500 mr-2">Sell:</span>
                                <span class="text-sm font-bold text-green-600" th:text="'₹' + ${#numbers.formatDecimal(product.sellingPrice ?: 0, 1, 2)}">$0.00</span>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <span class="inline-flex px-3 py-1.5 text-sm font-bold rounded-xl"
                                  th:classappend="${product.stockQuantity == null or product.stockQuantity == 0 ? 'bg-red-100 text-red-800' :
                                                  (product.lowStockThreshold != null and product.stockQuantity <= product.lowStockThreshold ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800')}"
                                  th:text="${product.stockQuantity ?: 0}">0</span>
                            <span class="ml-2 text-xs text-gray-500">units</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div th:if="${product.actualPrice != null && product.sellingPrice != null && product.sellingPrice > 0}">
                            <div class="text-sm font-bold"
                                 th:with="margin=${((product.sellingPrice - product.actualPrice) / product.sellingPrice) * 100}"
                                 th:classappend="${margin > 30 ? 'text-green-600' : (margin > 15 ? 'text-yellow-600' : 'text-red-600')}"
                                 th:text="${#numbers.formatDecimal(margin, 1, 1)} + '%'">0.0%</div>
                            <div class="text-xs text-gray-500">profit margin</div>
                        </div>
                        <div th:unless="${product.actualPrice != null && product.sellingPrice != null && product.sellingPrice > 0}" class="text-xs text-gray-400">
                            No data
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-bold bg-purple-100 text-purple-800"
                                  th:text="${product.quantitySold ?: 0}">0</span>
                            <span class="ml-2 text-xs text-gray-500">sold</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <div class="flex items-center justify-end space-x-2">
                            <a th:href="@{/products/{id}(id=${product.productId})}"
                               class="inline-flex items-center px-3 py-2 border border-transparent text-xs font-semibold rounded-lg text-blue-600 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-150">
                                <i class="bi bi-eye mr-1"></i>View
                            </a>
                            <a th:href="@{/products/{id}/edit(id=${product.productId})}"
                               class="inline-flex items-center px-3 py-2 border border-gray-300 text-xs font-semibold rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-150">
                                <i class="bi bi-pencil mr-1"></i>Edit
                            </a>
                            <a th:href="@{/products/{id}/stock(id=${product.productId})}"
                               class="inline-flex items-center px-3 py-2 border border-orange-300 text-xs font-semibold rounded-lg text-orange-600 bg-orange-100 hover:bg-orange-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-all duration-150">
                                <i class="bi bi-boxes mr-1"></i>Stock
                            </a>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <!-- Top Performers Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- Most Profitable Products -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6 animate-fade-in" style="animation-delay: 0.8s;">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="bi bi-trophy mr-2"></i>Most Profitable Products
            </h3>
            <div class="space-y-3" th:if="${!#lists.isEmpty(mostProfitableProducts)}">
                <div th:each="product : ${mostProfitableProducts}" class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-8 h-8 product-avatar rounded-lg flex items-center justify-center mr-3">
                            <i class="bi bi-box text-white text-sm"></i>
                        </div>
                        <div>
                            <div class="text-sm font-semibold text-gray-900" th:text="${product.name}">Product Name</div>
                            <div class="text-xs text-gray-500" th:text="${product.brandName}">Brand</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-bold text-green-600"
                             th:text="'₹' + ${#numbers.formatDecimal((product.sellingPrice - product.actualPrice), 1, 0)}">$0</div>
                        <div class="text-xs text-gray-500">profit</div>
                    </div>
                </div>
            </div>
            <div th:if="${#lists.isEmpty(mostProfitableProducts)}" class="text-center text-gray-500 py-4">
                No profitable products data available
            </div>
        </div>

        <!-- Low Stock Alert -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6 animate-fade-in" style="animation-delay: 0.9s;">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="bi bi-exclamation-triangle mr-2"></i>Low Stock Alert
            </h3>
            <div class="space-y-3" th:if="${!#lists.isEmpty(lowStockProducts)}">
                <div th:each="product : ${lowStockProducts}" class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-red-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="bi bi-box text-white text-sm"></i>
                        </div>
                        <div>
                            <div class="text-sm font-semibold text-gray-900" th:text="${product.name}">Product Name</div>
                            <div class="text-xs text-gray-500" th:text="${product.brandName}">Brand</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-bold text-red-600" th:text="${product.stockQuantity} + ' left'">0 left</div>
                        <div class="text-xs text-gray-500">stock</div>
                    </div>
                </div>
            </div>
            <div th:if="${#lists.isEmpty(lowStockProducts)}" class="text-center text-green-500 py-4">
                <i class="bi bi-check-circle mr-2"></i>All products have sufficient stock
            </div>
        </div>
    </div>
    <!-- Analytics Dashboard -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <!-- Brand Distribution -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6 animate-fade-in" style="animation-delay: 0.5s;">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="bi bi-tags mr-2"></i>Brand Distribution
            </h3>
            <div class="space-y-3" th:if="${productsByBrand != null}">
                <div th:each="entry : ${productsByBrand}" class="flex justify-between items-center">
                    <span class="text-sm text-gray-600" th:text="${entry.key}">Brand</span>
                    <div class="flex items-center">
                        <div class="w-16 h-2 bg-gray-200 rounded-full mr-2">
                            <div class="h-2 bg-purple-500 rounded-full"
                                 th:style="'width: ' + ${totalProducts > 0 ? (entry.value * 100 / totalProducts) : 0} + '%'"></div>
                        </div>
                        <span class="text-sm font-semibold text-purple-600" th:text="${entry.value}">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Price Range Analysis -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6 animate-fade-in" style="animation-delay: 0.6s;">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="bi bi-bar-chart mr-2"></i>Price Range Analysis
            </h3>
            <div class="space-y-3" th:if="${priceRangeDistribution != null}">
                <div th:each="entry : ${priceRangeDistribution}" class="flex justify-between items-center">
                    <span class="text-sm text-gray-600" th:text="${entry.key}">Price Range</span>
                    <div class="flex items-center">
                        <div class="w-16 h-2 bg-gray-200 rounded-full mr-2">
                            <div class="h-2 bg-green-500 rounded-full"
                                 th:style="'width: ' + ${totalProducts > 0 ? (entry.value * 100 / totalProducts) : 0} + '%'"></div>
                        </div>
                        <span class="text-sm font-semibold text-green-600" th:text="${entry.value}">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Supplier Distribution -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6 animate-fade-in" style="animation-delay: 0.7s;">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="bi bi-building mr-2"></i>Supplier Distribution
            </h3>
            <div class="space-y-3" th:if="${productsBySupplier != null}">
                <div th:each="entry : ${productsBySupplier}" class="flex justify-between items-center">
                    <span class="text-sm text-gray-600" th:text="${entry.key}">Supplier</span>
                    <div class="flex items-center">
                        <div class="w-16 h-2 bg-gray-200 rounded-full mr-2">
                            <div class="h-2 bg-blue-500 rounded-full"
                                 th:style="'width: ' + ${totalProducts > 0 ? (entry.value * 100 / totalProducts) : 0} + '%'"></div>
                        </div>
                        <span class="text-sm font-semibold text-blue-600" th:text="${entry.value}">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>





    <!-- Performance Summary Section -->
    <div class="mt-8 animate-fade-in" style="animation-delay: 1.1s;">
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-6">
                <i class="bi bi-graph-up mr-2"></i>Category Performance Summary
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="bi bi-calculator text-blue-600 text-xl"></i>
                    </div>
                    <div class="text-2xl font-bold text-blue-600"
                         th:text="${#numbers.formatDecimal(avgActualPrice != null ? avgActualPrice : 0, 1, 0)}">
                        $0
                    </div>
                    <div class="text-sm text-gray-600 mt-1">Avg Cost Price</div>
                    <div class="text-xs text-blue-600 mt-1">Per Product</div>
                </div>

                <div class="text-center p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl border border-green-100">
                    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="bi bi-currency-dollar text-green-600 text-xl"></i>
                    </div>
                    <div class="text-2xl font-bold text-green-600"
                         th:text="${#numbers.formatDecimal(avgSellingPrice != null ? avgSellingPrice : 0, 1, 0)}">
                        $0
                    </div>
                    <div class="text-sm text-gray-600 mt-1">Avg Selling Price</div>
                    <div class="text-xs text-green-600 mt-1">Per Product</div>
                </div>

                <div class="text-center p-4 bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl border border-purple-100">
                    <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="bi bi-percent text-purple-600 text-xl"></i>
                    </div>
                    <div class="text-2xl font-bold text-purple-600" th:text="${#numbers.formatDecimal(avgProfitMargin ?: 0, 1, 1)} + '%'">0.0%</div>
                    <div class="text-sm text-gray-600 mt-1">Avg Profit Margin</div>
                    <div class="text-xs text-purple-600 mt-1">Category Average</div>
                </div>

                <div class="text-center p-4 bg-gradient-to-br from-orange-50 to-red-50 rounded-xl border border-orange-100">
                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="bi bi-heart-pulse text-orange-600 text-xl"></i>
                    </div>
                    <div class="text-2xl font-bold text-orange-600" th:text="${#numbers.formatDecimal(stockHealthPercentage ?: 0, 1, 0)} + '%'">100%</div>
                    <div class="text-sm text-gray-600 mt-1">Stock Health</div>
                    <div class="text-xs"
                         th:classappend="${stockHealthPercentage > 80 ? 'text-green-600' : (stockHealthPercentage > 60 ? 'text-yellow-600' : 'text-red-600')}"
                         th:text="${stockHealthPercentage > 80 ? 'Excellent' : (stockHealthPercentage > 60 ? 'Good' : 'Needs Attention')}">Status</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Information Panel -->
    <div class="mt-8 bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6 animate-fade-in" style="animation-delay: 1.2s;">
        <div class="flex items-start gap-4">
            <div class="w-16 h-16 category-avatar rounded-2xl flex items-center justify-center">
                <i class="bi bi-info-circle-fill text-white text-2xl"></i>
            </div>
            <div class="flex-1">
                <h3 class="text-xl font-bold text-gray-900 mb-3">Category Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">Category Details</h4>
                        <div class="space-y-2 text-sm text-gray-600">
                            <p><strong>Name:</strong> <span th:text="${category.name}">Category Name</span></p>
                            <p th:if="${category.description}"><strong>Description:</strong> <span th:text="${category.description}">Category Description</span></p>
                            <p><strong>Status:</strong>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full text-white"
                                      th:classappend="${(category.status == null or category.status == 'ACTIVE') ? 'bg-green-500' : 'bg-red-500'}"
                                      th:text="${category.status ?: 'ACTIVE'}">ACTIVE</span>
                            </p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">Quick Stats</h4>
                        <div class="space-y-2 text-sm text-gray-600">
                            <p><strong>Total Products:</strong> <span th:text="${totalProducts}">0</span></p>
                            <p><strong>Low Stock Items:</strong> <span th:text="${lowStockCount}">0</span></p>
                            <p><strong>Out of Stock:</strong> <span th:text="${outOfStockProducts}">0</span></p>
                            <p><strong>Category Value:</strong> <span th:text="'₹' + ${#numbers.formatDecimal(totalPotentialRevenue ?: 0, 1, 2)}">$0.00</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<th:block layout:fragment="scripts">
    <script>
        // Auto-hide flash messages
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert-success, .alert-error');
            alerts.forEach(function(alert) {
                alert.style.transition = 'opacity 0.5s ease-out';
                alert.style.opacity = '0';
                setTimeout(function() {
                    alert.remove();
                }, 500);
            });
        }, 5000);

        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('productSearch');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const rows = document.querySelectorAll('tbody tr:not(:first-child)');
                    let visibleCount = 0;

                    rows.forEach(function(row) {
                        const text = row.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        row.style.display = isVisible ? '' : 'none';
                        if (isVisible) visibleCount++;
                    });

                    // Update search feedback
                    const feedback = document.getElementById('searchFeedback');
                    if (!feedback) {
                        const feedbackEl = document.createElement('div');
                        feedbackEl.id = 'searchFeedback';
                        feedbackEl.className = 'text-xs text-gray-500 mt-1';
                        searchInput.parentNode.appendChild(feedbackEl);
                    }
                    document.getElementById('searchFeedback').textContent =
                        searchTerm ? `${visibleCount} products found` : '';
                });
            }
        });

        // Export products function
        function exportProductData() {
            const categoryName = /*[[${category.name}]]*/ 'Category';
            let csvContent = "Product ID,Name,Brand,Supplier,Cost Price,Selling Price,Stock,Profit Margin,Quantity Sold\n";

            const rows = document.querySelectorAll('tbody tr:not(:first-child)');
            rows.forEach(function(row) {
                const cells = row.querySelectorAll('td');
                if (cells.length > 1) {
                    const productLink = cells[0].querySelector('a');
                    const productId = productLink ? productLink.getAttribute('href').split('/').pop() : '';
                    const name = productLink ? productLink.textContent : '';
                    const brand = cells[1].querySelector('.font-medium') ? cells[1].querySelector('.font-medium').textContent : '';
                    const supplier = cells[1].querySelectorAll('div')[1] ? cells[1].querySelectorAll('div')[1].textContent : '';
                    const costPrice = cells[2].querySelector('.text-orange-600') ? cells[2].querySelector('.text-orange-600').textContent : '';
                    const sellingPrice = cells[2].querySelector('.text-green-600') ? cells[2].querySelector('.text-green-600').textContent : '';
                    const stock = cells[3].querySelector('span') ? cells[3].querySelector('span').textContent : '';
                    const margin = cells[4].querySelector('div') ? cells[4].querySelector('div').textContent : '';
                    const sold = cells[5].querySelector('span') ? cells[5].querySelector('span').textContent : '';

                    csvContent += `"${productId}","${name}","${brand}","${supplier}","${costPrice}","${sellingPrice}","${stock}","${margin}","${sold}"\n`;
                }
            });

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${categoryName.replace(/\s+/g, '_')}_products_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Animate cards on load
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.metric-card, .investment-card, .revenue-card, .profit-card, .stock-card');
            cards.forEach(function(card, index) {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'all 0.5s ease';

                setTimeout(function() {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });

        // Add tooltips for better UX
        document.addEventListener('DOMContentLoaded', function() {
            const stockElements = document.querySelectorAll('[class*="bg-red-100"], [class*="bg-yellow-100"], [class*="bg-green-100"]');
            stockElements.forEach(function(element) {
                element.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.1)';
                });
                element.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                });
            });
        });
    </script>
</th:block>
</body>
</html>